# WageManager 사용자 플로우

## 목차
1. [고용주 플로우](#고용주-플로우)
2. [근로자 플로우](#근로자-플로우)
3. [통합 시나리오](#통합-시나리오)

---

## 핵심 개념

### WorkRecord의 이중 역할과 4가지 상태
- **예정 (SCHEDULED)**: 고용주가 미리 등록한 근무 예정 상태 (근무 전)
- **수정 (MODIFIED_BEFORE)**: 근무 시작 전에 시간이 변경된 상태 (근무 전)
- **완료 (COMPLETED)**: 근무가 완료되고 확정된 상태 (근무 후)
- **수정 (MODIFIED_AFTER)**: 근무 완료 후 시간이 수정된 상태 (근무 후, 정정 요청 승인 시)
- 하나의 엔티티로 일정과 기록을 모두 관리하여 데이터 일관성 유지

### 시간 필드 단순화
- **start_time / end_time**: 하나의 시간 필드로 통합
- 예정 시간으로 등록 → 필요시 실제 시간으로 수정
- actual 필드 불필요 (어차피 수정하면 start/end 자체를 업데이트)

---

## 고용주 플로우

### 사례: 박성호 사장님 (카페 운영자, 아르바이트생 5명 고용)

#### 1️⃣ 카카오 로그인 및 초기 설정

```
1. 카카오 소셜 로그인 (신규 사용자는 자동 회원가입)
   - 카카오 API에서 자동 추출:
     * 이름: 박성호
     * 전화번호: 010-1234-5678
     * 프로필 이미지
   - 역할 선택: 고용주(EMPLOYER)

   ⚠️ 별도의 회원가입 엔드포인트는 없으며, 로그인 시 자동으로 처리됨

2. 사업장 등록
   - 사업자등록번호: 123-45-67890 (유효성 검증)
   - 사업장명: (주)카페모카
   - 지점명: 홍대점
   - 주소: 서울시 마포구 홍익로 123
   - 색상: #FF6B6B (캘린더에서 빨간색으로 표시)
```

**데이터베이스 변화:**
```sql
-- 카카오 로그인 시 User 자동 생성 (신규 사용자인 경우)
INSERT INTO User (kakao_id, name, phone, user_type, profile_image_url)
VALUES ('kakao_12345', '박성호', '010-1234-5678', 'EMPLOYER', 'https://...');

-- Employer 테이블
INSERT INTO Employer (user_id, phone)
VALUES (1, '010-1234-5678');

-- Workplace 테이블
INSERT INTO Workplace (employer_id, business_number, business_name, name, address, color_code)
VALUES (1, '123-45-67890', '(주)카페모카', '홍대점', '서울시 마포구 홍익로 123', '#FF6B6B');
```

---

#### 2️⃣ 근로자 등록 및 계약 체결

```
박성호 사장님이 아르바이트생 김민지를 등록합니다.

1. 김민지의 고유 식별코드 입력: ABC123
   - 시스템이 근로자 정보 조회

2. 근로 계약 정보 입력
   - 시급: 10,000원
   - 근무요일: [1,2,3,4,5] (월~금)
   - 계약 시작일: 2025-11-01
   - 급여 지급일: 매월 25일
```

**데이터베이스 변화:**
```sql
-- WorkerContract 테이블
INSERT INTO WorkerContract
  (workplace_id, worker_id, hourly_wage, work_days, contract_start_date, payment_day, is_active)
VALUES
  (1, 1, 10000, '[1,2,3,4,5]', '2025-11-01', 25, true);
```

---

#### 3️⃣ 근무 일정 등록 (핵심!)

```
박성호 사장님이 김민지의 11월 근무 일정을 등록합니다.
이 단계가 WageManager의 핵심 기능입니다!

📋 일정 등록 화면:
┌─────────────────────────────────────┐
│ 근무 일정 등록                       │
├─────────────────────────────────────┤
│ 근무자: 김민지                       │
│ 날짜: 2025-11-01 (금)               │
│ 시작 시간: 09:00                     │
│ 종료 시간: 14:00                     │
│ 메모: [선택사항]                     │
│                                     │
│ [취소]  [일정 등록]                  │
└─────────────────────────────────────┘

일괄 등록 기능:
- "11월 전체 월~금 09:00~14:00로 일괄 등록" 버튼
- 반복 패턴 설정 가능
```

**데이터베이스 변화:**
```sql
-- WorkRecord 테이블에 SCHEDULED 상태로 생성
INSERT INTO WorkRecord
  (contract_id, work_date, start_time, end_time, status, memo)
VALUES
  (1, '2025-11-01', '09:00', '14:00', 'SCHEDULED', null);

-- 11월 전체 근무일 등록 (예시: 20일)
-- 총 20개의 SCHEDULED 상태 WorkRecord 생성
```

**중요**:
- `start_time`, `end_time`은 **예정 시간**
- `total_hours`, `regular_hours` 등은 **0** (아직 근무 안 함)
- 상태는 **SCHEDULED** (근무 예정)

---

#### 4️⃣ 캘린더에서 일정 확인

```
박성호 사장님이 11월 캘린더를 확인합니다.

📅 11월 캘린더 화면:
┌───────────────────────────────────────────┐
│  2025년 11월            [홍대점 ▼]        │
├───────────────────────────────────────────┤
│ 월   화   수   목   금   토   일           │
│                  1    2                   │
│ 김민지 김민지                             │
│ 09:00  09:00                              │
│  ~     ~                                  │
│ 14:00  14:00                              │
│                                           │
│ 4    5    6    7    8    9   10          │
│ 김민지 김민지 김민지 김민지               │
│ 09:00  09:00  09:00  09:00                │
│                                           │
│ ... (계속)                                │
└───────────────────────────────────────────┘

색상 표시:
- 빨간색 (#FF6B6B): 홍대점
- 파란색 (#4ECDC4): 강남점 (다른 사업장이 있다면)

상태별 스타일:
- SCHEDULED: 기본 스타일 (실선 테두리)
- MODIFIED_BEFORE: 수정된 스타일 (점선 테두리)
- COMPLETED: 진하게 표시 (채워진 배경)
- MODIFIED_AFTER: 진하게 표시 + 수정 표시 (채워진 배경 + 별표)
```

**API 호출:**
```
GET /api/employer/work-records?workplace_id=1&year=2025&month=11

Response:
[
  {
    "id": 1,
    "work_date": "2025-11-01",
    "start_time": "09:00",
    "end_time": "14:00",
    "status": "SCHEDULED",
    "worker": {
      "id": 1,
      "name": "김민지"
    }
  },
  ...
]
```

---

#### 5️⃣ 근무 완료 처리

```
시나리오: 근로자가 근무를 완료합니다.

11월 1일 14:05, 김민지가 근무를 완료합니다.
┌─────────────────────────────────────┐
│ 🕐 근무 완료 처리                   │
├─────────────────────────────────────┤
│ 근무지: 홍대점                       │
│ 예정 시간: 09:00 ~ 14:00            │
│                                     │
│ [근무 완료]                         │
└─────────────────────────────────────┘

근무 완료 버튼 클릭 → SCHEDULED → COMPLETED
(또는 MODIFIED_BEFORE → COMPLETED)
```

**데이터베이스 변화:**
```sql
-- 근무 완료 처리
UPDATE WorkRecord
SET status = 'COMPLETED',
    total_hours = 5.0,   -- 자동 계산
    regular_hours = 5.0,
    updated_at = NOW()
WHERE id = 1;
```

---

#### 6️⃣ 근무 일정 변경 (근무 전)

```
시나리오: 11월 10일, 박성호 사장님이 11월 15일 일정을 변경합니다.

변경 전: 09:00~14:00 (SCHEDULED)
변경 후: 10:00~15:00 (MODIFIED_BEFORE)

┌─────────────────────────────────────┐
│ 일정 수정                           │
├─────────────────────────────────────┤
│ 근무자: 김민지                       │
│ 날짜: 2025-11-15                    │
│                                     │
│ 시작 시간: [10:00] ◀▶               │
│ 종료 시간: [15:00] ◀▶               │
│ 메모: [재고 정리 예정]               │
│                                     │
│ [취소]  [저장]                      │
└─────────────────────────────────────┘
```

**데이터베이스 변화:**
```sql
-- WorkRecord 업데이트 (SCHEDULED → MODIFIED_BEFORE)
UPDATE WorkRecord
SET start_time = '10:00',
    end_time = '15:00',
    status = 'MODIFIED_BEFORE',
    memo = '재고 정리 예정',
    updated_at = NOW()
WHERE id = 15;

-- Notification 생성 (근로자에게)
INSERT INTO Notification
  (user_id, type, title, message, link_url, is_read)
VALUES
  (2, 'SCHEDULE_CHANGE', '근무 일정 변경',
   '11월 15일 근무 시간이 10:00~15:00로 변경되었습니다.',
   '/work-records/2025/11', false);
```

---

#### 7️⃣ 정정 요청 처리 (근무 후)

```
시나리오: 김민지가 11월 1일 근무 시간 정정을 요청했습니다.

📬 알림 수신:
"김민지님이 11월 1일 근무 시간 정정을 요청했습니다"

┌─────────────────────────────────────┐
│ 정정 요청 검토                       │
├─────────────────────────────────────┤
│ 요청자: 김민지                       │
│ 날짜: 2025-11-01                    │
│                                     │
│ [현재 기록]                         │
│ 시작: 09:00                         │
│ 종료: 14:00                         │
│ 총 근무: 5시간                      │
│                                     │
│ [요청 내용]                         │
│ 시작: 09:00                         │
│ 종료: 14:30 ⬅ 변경                 │
│ 총 근무: 5.5시간                    │
│                                     │
│ 사유: "손님이 많아서 30분 연장       │
│       근무했습니다"                  │
│                                     │
│ 검토 의견: [확인했습니다]            │
│                                     │
│ [반려]  [승인]                      │
└─────────────────────────────────────┘
```

**데이터베이스 변화 (승인 시):**
```sql
-- 1. CorrectionRequest 승인
UPDATE CorrectionRequest
SET status = 'APPROVED',
    reviewer_id = 1,
    reviewed_at = NOW(),
    review_comment = '확인했습니다'
WHERE id = 1;

-- 2. WorkRecord 업데이트 (COMPLETED → MODIFIED_AFTER)
UPDATE WorkRecord
SET end_time = '14:30',     -- 14:00 → 14:30
    total_hours = 5.5,      -- 자동 재계산
    regular_hours = 5.5,
    status = 'MODIFIED_AFTER',
    updated_at = NOW()
WHERE id = 1;

-- 3. Notification 생성 (근로자에게)
INSERT INTO Notification
  (user_id, type, title, message)
VALUES
  (2, 'CORRECTION_RESPONSE', '정정 요청 승인',
   '11월 1일 근무 시간 정정 요청이 승인되었습니다.');
```

---

#### 8️⃣ 월급 자동 계산

```
11월 30일, 시스템이 자동으로 김민지의 월급을 계산합니다.

계산 조건:
- COMPLETED, MODIFIED_AFTER 상태의 WorkRecord만 집계
- SCHEDULED, MODIFIED_BEFORE 상태는 제외 (아직 근무 안 함)

집계 결과:
- 총 근무일: 20일
- 총 근무 시간: 110시간
  - 일반 근무: 100시간
  - 연장 근무: 8시간
  - 야간 근무: 2시간

계산 내역 (DeductionCalculator 사용):
- 기본급: 1,000,000원 (100시간 × 10,000원)
- 연장 수당: 120,000원 (8시간 × 10,000원 × 1.5배)
- 야간 수당: 25,000원 (2시간 × 10,000원 × 1.25배)
- 총 지급액(세전): 1,145,000원
- 4대 보험: -115,000원 (DeductionCalculator로 자동 계산)
- 소득세: -20,000원 (PayrollDeductionType 기반 자동 계산)
- 지방소득세: -2,000원
- 실수령액: 1,008,000원

💡 급여 공제 시스템:
- DeductionCalculator 클래스가 4대 보험 및 세금을 자동 계산
- PayrollDeductionType enum으로 4가지 급여 공제 유형 지원
```

**데이터베이스 변화:**
```sql
-- Salary 자동 생성 (배치 작업 or 트리거)
INSERT INTO Salary
  (contract_id, year, month, total_work_hours, base_pay, overtime_pay, night_pay,
   total_gross_pay, four_major_insurance, income_tax, local_income_tax,
   total_deduction, net_pay, payment_due_date)
VALUES
  (1, 2025, 11, 110, 1000000, 120000, 25000,
   1145000, 115000, 20000, 2000,
   137000, 1008000, '2025-11-25');
```

---

#### 9️⃣ 급여 송금

```
11월 25일, 박성호 사장님이 급여를 송금합니다.

💰 송금 화면:
┌─────────────────────────────────────┐
│ 급여 송금                           │
├─────────────────────────────────────┤
│ 근무자: 김민지                       │
│ 지급월: 2025년 11월                 │
│                                     │
│ 실수령액: 1,008,000원               │
│                                     │
│ 송금 방법:                          │
│ ○ 카카오페이                        │
│ ○ 계좌이체                          │
│ ○ 현금                              │
│                                     │
│ [카카오페이로 송금하기]              │
└─────────────────────────────────────┘

카카오페이 선택 시:
→ 김민지의 카카오페이 링크 자동 열림
→ 금액 자동 입력: 1,008,000원
```

**데이터베이스 변화:**
```sql
-- Payment 생성
INSERT INTO Payment
  (salary_id, payment_method, status, payment_date, transaction_id)
VALUES
  (1, 'KAKAO_PAY', 'COMPLETED', NOW(), 'KP20251125ABC123');

-- Notification 생성
INSERT INTO Notification
  (user_id, type, title, message)
VALUES
  (2, 'PAYMENT_SUCCESS', '급여 입금 완료',
   '1,008,000원이 입금되었습니다.');
```

---

## 근로자 플로우

### 사례: 김민지 (24세, 대학생, 카페 아르바이트)

#### 1️⃣ 카카오 로그인 및 코드 발급

```
1. 카카오 소셜 로그인 (신규 사용자는 자동 회원가입)
   - 카카오 API에서 자동 추출:
     * 이름: 김민지
     * 전화번호: 010-9876-5432
     * 프로필 이미지
   - 역할 선택: 근로자(WORKER)

   ⚠️ 별도의 회원가입 엔드포인트는 없으며, 로그인 시 자동으로 처리됨

2. 시스템이 자동으로 고유 식별코드 생성
   - 코드: ABC123

   ┌─────────────────────────────────────┐
   │ 🎉 로그인 완료                      │
   ├─────────────────────────────────────┤
   │ 귀하의 근로자 식별코드:              │
   │                                     │
   │         ABC123                      │
   │                                     │
   │ 이 코드를 고용주에게 알려주세요.     │
   │ [코드 복사] [카카오톡 공유]          │
   └─────────────────────────────────────┘

3. 계좌 정보 입력 (선택)
   - 은행: 카카오뱅크
   - 계좌번호: 3333-12-1234567
   - 카카오페이 링크: https://qr.kakaopay.com/abc123
```

**데이터베이스 변화:**
```sql
-- 카카오 로그인 시 User 자동 생성 (신규 사용자인 경우)
INSERT INTO User (kakao_id, name, phone, user_type, profile_image_url)
VALUES ('kakao_67890', '김민지', '010-9876-5432', 'WORKER', 'https://...');

-- Worker 테이블
INSERT INTO Worker
  (user_id, worker_code, account_number, bank_name, kakao_pay_link)
VALUES
  (2, 'ABC123', 'ENCRYPTED(3333-12-1234567)', '카카오뱅크',
   'https://qr.kakaopay.com/abc123');
```

---

#### 2️⃣ 근무 일정 확인

```
김민지가 11월 첫째 주 일정을 확인합니다.

📅 내 근무 일정 (2025년 11월)
┌─────────────────────────────────────┐
│ 월   화   수   목   금   토   일     │
├─────────────────────────────────────┤
│                  1    2              │
│ 홍대점   홍대점                      │
│ 09:00    09:00                       │
│  ~       ~                           │
│ 14:00    14:00                       │
│ (예정)   (예정)                      │
│                                     │
│ 4    5    6    7    8               │
│ 홍대점  홍대점  홍대점  홍대점        │
│ 09:00   09:00   09:00   09:00        │
│  ~      ~      ~      ~              │
│ 14:00   14:00   14:00   14:00        │
│ (예정)  (확정)  (예정)  (예정)       │
└─────────────────────────────────────┘

상태 표시:
- (예정): SCHEDULED - 아직 근무 안 함
- (수정): MODIFIED_BEFORE - 근무 전 시간 변경됨
- (완료): COMPLETED - 근무 완료
- (수정*): MODIFIED_AFTER - 근무 완료 후 시간 수정됨
```

**API 호출:**
```
GET /api/worker/work-records?year=2025&month=11

Response:
[
  {
    "id": 1,
    "work_date": "2025-11-01",
    "start_time": "09:00",
    "end_time": "14:00",
    "status": "SCHEDULED",
    "workplace": {
      "name": "홍대점",
      "color_code": "#FF6B6B"
    }
  },
  {
    "id": 3,
    "work_date": "2025-11-03",
    "start_time": "10:00",
    "end_time": "15:00",
    "status": "MODIFIED_BEFORE",
    "workplace": {
      "name": "홍대점",
      "color_code": "#FF6B6B"
    }
  },
  {
    "id": 5,
    "work_date": "2025-11-05",
    "start_time": "09:00",
    "end_time": "14:05",
    "status": "COMPLETED",
    "workplace": {
      "name": "홍대점",
      "color_code": "#FF6B6B"
    }
  },
  ...
]
```

---

#### 3️⃣ 근무 시간 정정 요청

```
11월 1일 근무 후, 김민지가 실제 30분 더 일했다는 것을 확인합니다.

┌─────────────────────────────────────┐
│ 근무 시간 정정 요청                  │
├─────────────────────────────────────┤
│ 날짜: 2025-11-01 (금)               │
│ 근무지: 홍대점                       │
│                                     │
│ [현재 기록]                         │
│ 시작: 09:00                         │
│ 종료: 14:00                         │
│ 총 근무: 5시간                      │
│                                     │
│ [수정 요청]                         │
│ 시작: [09:00] ◀▶                    │
│ 종료: [14:30] ◀▶  ⬅ 수정           │
│                                     │
│ 사유: (필수)                        │
│ ┌─────────────────────────────┐    │
│ │손님이 많아서 30분 연장 근무   │    │
│ │했습니다.                     │    │
│ └─────────────────────────────┘    │
│                                     │
│ [취소]  [요청 전송]                 │
└─────────────────────────────────────┘
```

**API 호출:**
```
POST /api/worker/correction-requests

Request Body:
{
  "work_record_id": 1,
  "requested_work_date": "2025-11-01",
  "requested_start_time": "09:00",
  "requested_end_time": "14:30",
  "reason": "손님이 많아서 30분 연장 근무했습니다"
}

Response:
{
  "id": 1,
  "status": "PENDING",
  "message": "정정 요청이 전송되었습니다. 고용주 승인 대기 중입니다."
}
```

---

#### 4️⃣ 월별 급여 통계 확인

```
김민지가 2025년 급여 통계를 확인합니다.

📊 월별 급여 통계
┌─────────────────────────────────────┐
│     💰 2025년 급여 현황              │
├─────────────────────────────────────┤
│                                     │
│  1,200,000원                        │
│                ■                    │
│  1,000,000원   ■  ■     ■  ■  ■    │
│     800,000원 ■  ■  ■  ■  ■  ■    │
│     600,000원 ■  ■  ■  ■  ■  ■    │
│                                     │
│        1  2  3  4  5 ... 11월       │
│                                     │
│ 📅 11월 상세                         │
│ ├ 총 근무 시간: 110시간              │
│ ├ 기본급: 1,000,000원               │
│ ├ 연장 수당: 120,000원              │
│ ├ 야간 수당: 25,000원               │
│ ├ 총 지급액: 1,145,000원            │
│ ├ 4대 보험: -115,000원              │
│ ├ 소득세: -22,000원                 │
│ └ 실수령액: 1,008,000원 ✅          │
└─────────────────────────────────────┘
```

---

#### 5️⃣ 송금 확인

```
11월 25일 14:32, 김민지가 알림을 받습니다.

🔔 알림
┌─────────────────────────────────────┐
│ 💰 급여 입금 완료                    │
│                                     │
│ 1,008,000원이 입금되었습니다.       │
│                                     │
│ 지급월: 2025년 11월                 │
│ 근무지: 홍대점                       │
│ 송금일: 2025-11-25 14:32            │
│                                     │
│ [상세 보기]                         │
└─────────────────────────────────────┘
```

---

## 통합 시나리오

### 시나리오 1: 한 달 근무 전체 플로우

```
📅 타임라인

11월 1일 (금):
[박성호 사장] 11월 전체 일정 등록
  → WorkRecord 20개 생성 (status: SCHEDULED)

[김민지] 앱에서 11월 일정 확인
  → "이번 달 20일 근무 예정, 예상 급여: 1,000,000원"

11월 1일 퇴근 후:
[김민지] 근무 완료 처리 (14:00)
  → WorkRecord #1 상태: SCHEDULED → COMPLETED

11월 2일:
[김민지] 어제 30분 더 일한 거 생각나서 정정 요청
  → CorrectionRequest 생성

[박성호 사장] 알림 받고 승인
  → CorrectionRequest 승인
  → WorkRecord #1 상태: COMPLETED → MODIFIED_AFTER
  → WorkRecord #1 업데이트 (14:00 → 14:30)

11월 15일:
[박성호 사장] 갑자기 일정 변경 필요
  → WorkRecord #15 상태: SCHEDULED → MODIFIED_BEFORE
  → WorkRecord #15 업데이트 (09:00~14:00 → 10:00~15:00)
  → 김민지에게 알림 발송

[김민지] 알림 받고 확인
  → "11월 15일 일정이 변경되었습니다"

11월 30일 자정:
[시스템] 자동 급여 계산
  → Salary 레코드 생성
  → COMPLETED, MODIFIED_AFTER 상태 WorkRecord 20개 집계
  → 총 근무 110시간, 실수령액 1,008,000원 계산

11월 25일:
[박성호 사장] 급여 송금
  → Payment 생성 (COMPLETED)
  → 김민지에게 알림
```

---

### 시나리오 2: 다중 사업장 + 여러 근로자

```
박성호 사장님이 강남에 두 번째 지점을 오픈합니다.

📍 사업장 현황:
- 홍대점: 김민지, 이영희, 박철수 (3명)
- 강남점: 최지원, 정수아 (2명)

📅 캘린더 화면 (색상 구분):
┌─────────────────────────────────────┐
│  2025년 12월    [전체 사업장 ▼]     │
├─────────────────────────────────────┤
│ 월   화   수   목   금   토   일     │
├─────────────────────────────────────┤
│ 1    2    3    4    5    6    7     │
│ 🔴   🔴   🔴   🔴   🔴              │
│ 민지  민지  민지  민지  민지          │
│ 🔴   🔴   🔴   🔴   🔴              │
│ 영희  영희  영희  영희  영희          │
│ 🔵   🔵   🔵   🔵   🔵   🔵         │
│ 지원  지원  지원  지원  지원  지원      │
└─────────────────────────────────────┘

필터 기능:
- [홍대점만 보기] → 빨간색만 표시
- [강남점만 보기] → 파란색만 표시
- [김민지만 보기] → 김민지 일정만 표시

일괄 등록 기능:
[박성호 사장] "12월 전체 일정 일괄 등록"
  → 홍대점: 60개 WorkRecord 생성 (3명 × 20일)
  → 강남점: 40개 WorkRecord 생성 (2명 × 20일)
  → 총 100개 레코드 생성 (모두 SCHEDULED 상태)
```

---

## 주요 플로우 요약

### 고용주 핵심 기능
1. ✅ **근무 일정 등록** (가장 중요!)
   - WorkRecord를 SCHEDULED 상태로 생성
   - 일괄 등록 기능으로 한 번에 여러 일정 등록

2. ✅ 근무 전 일정 변경
   - SCHEDULED → MODIFIED_BEFORE 상태 변경
   - 근로자에게 자동 알림

3. ✅ 근무 완료 처리
   - SCHEDULED/MODIFIED_BEFORE → COMPLETED 상태 변경

4. ✅ 정정 요청 승인/반려 (근무 후)
   - COMPLETED → MODIFIED_AFTER 상태 변경

5. ✅ 급여 송금
   - COMPLETED/MODIFIED_AFTER 기록 기반 자동 계산된 급여 확인
   - 송금 처리

### 근로자 핵심 기능
1. ✅ 근무 일정 확인
   - SCHEDULED: 예정된 근무
   - MODIFIED_BEFORE: 수정된 예정 근무
   - COMPLETED: 완료된 근무
   - MODIFIED_AFTER: 수정된 완료 근무

2. ✅ 정정 요청
   - COMPLETED 기록에 대해 수정 요청
   - 승인 시 MODIFIED_AFTER로 변경

3. ✅ 급여 통계 확인
   - 월별 급여 차트
   - 상세 내역 확인

4. ✅ 알림 수신
   - 일정 변경
   - 정정 요청 결과
   - 급여 입금

### 시스템 자동화
1. ✅ WorkRecord 상태 관리
   - SCHEDULED → MODIFIED_BEFORE → COMPLETED → MODIFIED_AFTER 흐름

2. ✅ 급여 자동 계산
   - COMPLETED, MODIFIED_AFTER 상태 레코드만 집계
   - 연장/야간/휴일 수당 자동 계산

3. ✅ 실시간 알림
   - 일정 변경, 정정 요청, 송금 완료

---

## 데이터 흐름도

```
[고용주]
   │
   ├─→ [사업장 등록]
   │       │
   │       └─→ [근로자 계약]
   │               │
   │               ├─→ [근무 일정 등록] ← 핵심!
   │               │    (WorkRecord: SCHEDULED)
   │               │         │
   │               │         ├─→ [근무 전 일정 변경]
   │               │         │    (SCHEDULED → MODIFIED_BEFORE)
   │               │         │         │
   │               │         │         └─→ [알림] → [근로자]
   │               │         │
   │               │         └─→ [근무 완료]
   │               │              (SCHEDULED/MODIFIED_BEFORE → COMPLETED)
   │               │                   │
   │               │                   ├─→ [정정 요청] ← [근로자]
   │               │                   │        │
   │               │                   │   [승인 시]
   │               │                   │        │
   │               │                   │        v
   │               │                   │   (COMPLETED → MODIFIED_AFTER)
   │               │                   │
   │               │                   └─→ [급여 자동 계산]
   │               │                            │
   │               │                            └─→ [송금]
   │               │                                 │
   │               │                                 └─→ [알림] → [근로자]
   │               │
   │               └─→ [캘린더 조회]
   │                    (모든 상태 표시: SCHEDULED/MODIFIED_BEFORE/COMPLETED/MODIFIED_AFTER)
   │
   └─→ [캘린더 조회]
```

---

## WorkRecord 상태 다이어그램

```
[고용주가 일정 등록]
         │
         v
    SCHEDULED ────────────┐
         │                │
         │          [근무 전 수정]
         │                │
         │                v
         │        MODIFIED_BEFORE
         │                │
         │                │
         └────────┬───────┘
                  │
            [근무 완료]
                  │
                  v
             COMPLETED ──────────┐
                  │              │
                  │        [근무 후 수정]
                  │        (정정 요청 승인)
                  │              │
                  │              v
                  │      MODIFIED_AFTER
                  │              │
                  │              │
                  └──────┬───────┘
                         │
                   [급여 계산에 사용]
                         │
                         v
                   [Salary 생성]

상태 전이 규칙:
1. SCHEDULED → MODIFIED_BEFORE: 근무 전 시간 수정
2. SCHEDULED → COMPLETED: 근무 완료 (시간 변경 없음)
3. MODIFIED_BEFORE → COMPLETED: 근무 완료
4. COMPLETED → MODIFIED_AFTER: 정정 요청 승인 (근무 후 수정)
5. 급여 계산: COMPLETED 또는 MODIFIED_AFTER 상태만 집계
```
